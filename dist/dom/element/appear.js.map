{"version":3,"sources":["dom/element/appear.js"],"names":["global","document","setInterval","undefined","compatMode","Error","provide","Weakmap","DomElement","functionMerge","functionDebounce","documentElement","window","viewport","storage","elements","EVENTS_RESIZE","EVENT_APPEAR","EVENT_DISAPPEAR","updateViewport","left","top","right","innerWidth","clientWidth","bottom","innerHeight","clientHeight","updateBoundaries","properties","get","this","settings","boundaries","treshold","threshold","x","auto","y","isWithinBoundaries","element","rect","getBoundingClientRect","check","node","DomElementAppear","self","call","set","state","on","bind","push","i","visibility","isVisible","emit","priority","recur","splice","extends"],"mappings":"CAQC,SAASA,EAAQC,EAAUC,EAAaC,GACxC,aAEA,GAA2B,eAAxBF,EAASG,WACX,MAAM,IAAIC,MAAM,yCAqIjBC,QAAQ,CAAE,kBAAmB,aAAc,uBAAwB,2BAlInE,SAAoBC,EAASC,EAAYC,EAAeC,GACvD,IAAIC,EAAmBV,EAASU,gBAC/BC,EAAmB,IAAIJ,EAAWR,GAClCa,EAAmB,GACnBC,EAAmB,IAAIP,EACvBQ,EAAmB,GACnBC,EAAmB,2BACnBC,EAAmB,SACnBC,EAAmB,YA0CpB,SAASC,IACRN,EAASO,KAAS,EAClBP,EAASQ,IAAS,EAClBR,EAASS,MAAStB,EAAOuB,YAAcZ,EAAgBa,YACvDX,EAASY,OAASzB,EAAO0B,aAAef,EAAgBgB,aAGzD,SAASC,IACR,IAAIC,EAAaf,EAAQgB,IAAIC,MAC5BC,EAAaH,EAAWG,SACxBC,EAAaJ,EAAWI,WACxBC,EAAaF,EAASG,UACtBC,EAAcF,IAAa/B,EAAa+B,EAAWvB,EAAgBa,YAAcQ,EAASK,KAC1FC,EAAcJ,IAAa/B,EAAa+B,EAAWvB,EAAgBgB,aAAeK,EAASK,KAE5FJ,EAAWb,KAASP,EAASO,KAAOgB,EACpCH,EAAWZ,IAASR,EAASQ,IAAMiB,EACnCL,EAAWX,MAAST,EAASS,MAAQc,EACrCH,EAAWR,OAASZ,EAASY,OAASa,EAGvC,SAASC,EAAmBC,EAASP,GACpC,IAAIQ,EAAOD,EAAQE,wBAEnB,QAAGD,EAAKnB,OAASW,EAAWb,MAAQqB,EAAKhB,QAAUQ,EAAWZ,KAAOoB,EAAKrB,MAAQa,EAAWX,OAASmB,EAAKpB,KAAOY,EAAWR,QAO9H,SAASkB,IACR,IACCC,EADgBb,KACEa,KAClBf,EAAaf,EAAQgB,IAFLC,MAIjB,OAAGQ,EAAmBK,EAAM/B,GACpB,EAGL0B,EAAmBK,EAAMf,EAAWI,YAC/B,EAGD,EAGR,SAASY,EAAiBL,EAASR,GAClC,IAAIc,EAAOtC,EAAWuC,KAAKhB,KAAMS,GAmBjC,MAf0B,UAF1BR,EAAWvB,EAAc,GAAIoC,EAAiBb,SAAUA,IAE5CG,kBACJH,EAASG,UAGjBrB,EAAQkC,IAAIF,EAAM,CACjBd,SAAYA,EACZC,WAAY,GACZgB,OAAa,IAGdrC,EAAOsC,GAAGlC,EAAeN,EAAiBkB,EAAiBuB,KAAKL,KAEhElB,EAAiBmB,KAAKD,GACtB/B,EAASqC,KAAKN,GAEPA,EAUR,OArHAlC,EAAOsC,GAAGlC,EAAeN,EAAiBS,IAC1CA,IAEAjB,EAAY,WAGX,IAFA,IAAWsC,EAASX,EAAYG,EAAUiB,EAAtCI,EAAI,EAEFb,EAAUzB,EAASsC,GAAIA,IAI5B,KAFArB,GADAH,EAAaf,EAAQgB,IAAIU,IACDR,UAEXsB,YAAcd,EAAQe,YAAa,CAG/C,IAFAN,EAAQN,EAAMI,KAAKP,MAENX,EAAWoB,MAAO,CAC9B,OAAOA,GACN,KAAK,EACJT,EAAQgB,KAAKtC,EAAiB,CAAEuC,SAAU,IAE1C,MACD,KAAK,EACJjB,EAAQgB,KAAK3B,EAAWoB,OAAS,EAAIhC,EAAeC,EAAiB,CAAEuC,SAAU,IAEjF,MACD,KAAK,EACJjB,EAAQgB,KAAKvC,EAAc,CAAEwC,SAAU,IAKzC5B,EAAWoB,MAAQA,EAGhBjB,EAAS0B,OAAmB,IAAVT,IACrBlC,EAAS4C,OAAON,EAAG,GACnBA,OAID,IAAO,IAwEVR,EAAiBb,SAAW,CAC3BG,UAAY,OACZuB,OAAY,EACZrB,KAAY,EACZiB,YAAY,GAGNT,EAAiBe,QAAQpD,KAtIlC,CA0IEuB,KAAM9B,SAAUC","file":"appear.js","sourcesContent":["/**\n * @use /demand/weakmap\n *\n * @require ../element\n * @require ../../function/merge\n * @require ../../function/debounce\n */\n\n(function(global, document, setInterval, undefined) {\n\t'use strict';\n\n\tif(document.compatMode !== 'CSS1Compat') {\n\t\tthrow new Error('Browser needs to be in standards mode');\n\t}\n\n\tfunction definition(Weakmap, DomElement, functionMerge, functionDebounce) {\n\t\tvar documentElement  = document.documentElement,\n\t\t\twindow           = new DomElement(global),\n\t\t\tviewport         = {},\n\t\t\tstorage          = new Weakmap(),\n\t\t\telements         = [],\n\t\t\tEVENTS_RESIZE    = 'resize orientationchange',\n\t\t\tEVENT_APPEAR     = 'appear',\n\t\t\tEVENT_DISAPPEAR  = 'disappear';\n\n\t\twindow.on(EVENTS_RESIZE, functionDebounce(updateViewport));\n\t\tupdateViewport();\n\n\t\tsetInterval(function() {\n\t\t\tvar i = 0, element, properties, settings, state;\n\n\t\t\tfor(; element = elements[i]; i++) {\n\t\t\t\tproperties = storage.get(element);\n\t\t\t\tsettings   = properties.settings;\n\n\t\t\t\tif(!settings.visibility || element.isVisible()) {\n\t\t\t\t\tstate = check.call(element);\n\n\t\t\t\t\tif(state !== properties.state) {\n\t\t\t\t\t\tswitch(state) {\n\t\t\t\t\t\t\tcase 0:\n\t\t\t\t\t\t\t\telement.emit(EVENT_DISAPPEAR, { priority: 1 });\n\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 1:\n\t\t\t\t\t\t\t\telement.emit(properties.state <= 0 ? EVENT_APPEAR : EVENT_DISAPPEAR, { priority: 2 });\n\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 2:\n\t\t\t\t\t\t\t\telement.emit(EVENT_APPEAR, { priority: 1 });\n\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tproperties.state = state;\n\t\t\t\t\t}\n\n\t\t\t\t\tif(!settings.recur && state === 2) {\n\t\t\t\t\t\telements.splice(i, 1);\n\t\t\t\t\t\ti--;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}, 1000 / 30);\n\n\t\tfunction updateViewport() {\n\t\t\tviewport.left   = 0;\n\t\t\tviewport.top    = 0;\n\t\t\tviewport.right  = global.innerWidth || documentElement.clientWidth;\n\t\t\tviewport.bottom = global.innerHeight || documentElement.clientHeight;\n\t\t}\n\n\t\tfunction updateBoundaries() {\n\t\t\tvar properties = storage.get(this),\n\t\t\t\tsettings   = properties.settings,\n\t\t\t\tboundaries = properties.boundaries,\n\t\t\t\ttreshold   = settings.threshold,\n\t\t\t\tx          = (treshold !== undefined) ? treshold : documentElement.clientWidth * settings.auto,\n\t\t\t\ty          = (treshold !== undefined) ? treshold : documentElement.clientHeight * settings.auto;\n\n\t\t\tboundaries.left   = viewport.left - x;\n\t\t\tboundaries.top    = viewport.top - y;\n\t\t\tboundaries.right  = viewport.right + x;\n\t\t\tboundaries.bottom = viewport.bottom + y;\n\t\t}\n\n\t\tfunction isWithinBoundaries(element, boundaries) {\n\t\t\tvar rect = element.getBoundingClientRect();\n\n\t\t\tif(rect.right <= boundaries.left || rect.bottom <= boundaries.top || rect.left >= boundaries.right || rect.top >= boundaries.bottom) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\tfunction check() {\n\t\t\tvar self       = this,\n\t\t\t\tnode       = self.node,\n\t\t\t\tproperties = storage.get(self);\n\n\t\t\tif(isWithinBoundaries(node, viewport)) {\n\t\t\t\treturn 2;\n\t\t\t}\n\n\t\t\tif(isWithinBoundaries(node, properties.boundaries)) {\n\t\t\t\treturn 1;\n\t\t\t}\n\n\t\t\treturn 0;\n\t\t}\n\n\t\tfunction DomElementAppear(element, settings) {\n\t\t\tvar self = DomElement.call(this, element);\n\n\t\t\tsettings = functionMerge({}, DomElementAppear.settings, settings);\n\n\t\t\tif(settings.threshold === 'auto') {\n\t\t\t\tdelete settings.threshold;\n\t\t\t}\n\n\t\t\tstorage.set(self, {\n\t\t\t\tsettings:   settings,\n\t\t\t\tboundaries: {},\n\t\t\t\tstate:      -1\n\t\t\t});\n\n\t\t\twindow.on(EVENTS_RESIZE, functionDebounce(updateBoundaries.bind(self)));\n\n\t\t\tupdateBoundaries.call(self);\n\t\t\telements.push(self);\n\n\t\t\treturn self;\n\t\t}\n\n\t\tDomElementAppear.settings = {\n\t\t\tthreshold:  'auto',\n\t\t\trecur:      true,\n\t\t\tauto:       1,\n\t\t\tvisibility: true\n\t\t};\n\n\t\treturn DomElementAppear.extends(DomElement);\n\t}\n\n\tprovide([ '/demand/weakmap', '../element', '../../function/merge', '../../function/debounce' ], definition);\n}(this, document, setInterval));\n"]}