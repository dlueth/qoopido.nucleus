{"version":3,"sources":["url.js"],"names":["global","document","provide","abstractUuid","Descriptor","iterate","resolver","objectDefineProperties","Object","defineProperties","storage","regexMatchLeadingSlash","regexMatchParameter","regexMatchSpaces","regexMatchOpeningBrackets","regexMatchClosingBrackets","regexMatchLocal","RegExp","createElement","href","slice","regexMatchDefaults","http:","https:","ftp:","getLinkProperty","uuid","property","properties","link","setLinkProperty","value","Parameter","this","update","Url","url","self","call","parameter","toString","valueOf","prototype","get","name","set","serialize","remove","context","tokens","search","split","join","exec","decodeURIComponent","result","encodeURIComponent","replace","local","test","origin","protocol","host","username","password","hostname","port","pathname","hash","extends"],"mappings":"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","file":"url.js","sourcesContent":["/**\n * @use /demand/abstract/uuid\n * @use /demand/descriptor\n * @use /demand/function/iterate\n */\n\n(function(global, document) {\n\t'use strict';\n\n\tfunction definition(abstractUuid, Descriptor, iterate) {\n\t\tvar objectDefineProperties    = Object.defineProperties,\n\t\t\tstorage                   = {},\n\t\t\tregexMatchLeadingSlash    = /^\\//,\n\t\t\tregexMatchParameter       = /[?&]?([^=]+)=([^&]*)/g,\n\t\t\tregexMatchSpaces          = /%20/g,\n\t\t\tregexMatchOpeningBrackets = /%5B/g,\n\t\t\tregexMatchClosingBrackets = /%5D/g,\n\t\t\tregexMatchLocal           = new RegExp('^' + resolveCurrent(), 'i'),\n\t\t\tregexMatchDefaults        = {\n\t\t\t\t'http:':  /:80$/,\n\t\t\t\t'https:': /:443$/,\n\t\t\t\t'ftp:':   /:21$/\n\t\t\t};\n\n\t\tfunction resolveCurrent() {\n\t\t\tvar resolver = document.createElement('a');\n\n\t\t\tresolver.href = '/';\n\n\t\t\treturn resolver.href.slice(0, -1);\n\t\t}\n\n\t\tfunction getLinkProperty(uuid, property) {\n\t\t\tvar properties;\n\n\t\t\tif(properties = storage[uuid]) {\n\t\t\t\treturn properties.link[property];\n\t\t\t}\n\t\t}\n\n\t\tfunction setLinkProperty(uuid, property, value) {\n\t\t\tvar properties;\n\n\t\t\tif(properties = storage[uuid]) {\n\t\t\t\tproperties.link[property] = value;\n\t\t\t}\n\t\t}\n\n\t\tfunction Parameter(uuid) {\n\t\t\tvar self = this;\n\n\t\t\tobjectDefineProperties(self, { uuid: new Descriptor(uuid) });\n\n\t\t\tParameter.update(self);\n\t\t}\n\n\t\tParameter.prototype = {\n\t\t\t/* only for reference\n\t\t\tuuid: null\n\t\t\t*/\n\t\t\tget: function(name) {\n\t\t\t\treturn storage[this.uuid].parameter[name];\n\t\t\t},\n\t\t\tset: function(name, value) {\n\t\t\t\tstorage[this.uuid].parameter[name] = value;\n\n\t\t\t\tParameter.serialize(this);\n\t\t\t},\n\t\t\tremove: function(name) {\n\t\t\t\tdelete storage[this.uuid].parameter[name];\n\n\t\t\t\tParameter.serialize(this);\n\t\t\t}\n\t\t};\n\n\t\tParameter.update = function(context) {\n\t\t\tvar properties = storage[context.uuid],\n\t\t\t\tparameter  = properties.parameter,\n\t\t\t\tsearch     = properties.link.search.split('+').join(' '),\n\t\t\t\ttokens;\n\n\t\t\titerate(parameter, function(property) {\n\t\t\t\tdelete parameter[property];\n\t\t\t});\n\n\t\t\twhile(tokens = regexMatchParameter.exec(search)) {\n\t\t\t\tparameter[decodeURIComponent(tokens[1])] = decodeURIComponent(tokens[2]);\n\t\t\t}\n\t\t};\n\n\t\tParameter.serialize = function(context) {\n\t\t\tvar properties = storage[context.uuid],\n\t\t\t\tparameter  = properties.parameter,\n\t\t\t\tresult     = '';\n\n\t\t\titerate(parameter, function(property, value) {\n\t\t\t\tresult += (!result ? '?' : '&') + encodeURIComponent(property) + '=' + encodeURIComponent(value);\n\t\t\t});\n\n\t\t\tproperties.link.search = result\n\t\t\t\t.replace(regexMatchSpaces, '+')\n\t\t\t\t.replace(regexMatchOpeningBrackets, '[')\n\t\t\t\t.replace(regexMatchClosingBrackets, ']');\n\t\t};\n\n\t\tfunction Url(url) {\n\t\t\tvar self = abstractUuid.call(this),\n\t\t\t\tlink = document.createElement('a');\n\n\t\t\tlink.href = url;\n\n\t\t\tstorage[self.uuid] = {\n\t\t\t\tlink:      link,\n\t\t\t\tparameter: {}\n\t\t\t};\n\n\t\t\tobjectDefineProperties(self, {\n\t\t\t\ttoString:  new Descriptor(function() { return link.toString(); }),\n\t\t\t\tvalueOf:   new Descriptor(function() { return link.valueOf(); }),\n\t\t\t\tparameter: new Descriptor(new Parameter(self.uuid))\n\t\t\t});\n\n\t\t\treturn self;\n\t\t}\n\n\t\tUrl.prototype = {\n\t\t\tget local() {\n\t\t\t\tvar value;\n\n\t\t\t\tif(value = getLinkProperty(this.uuid, 'href')) {\n\t\t\t\t\treturn regexMatchLocal.test(value);\n\t\t\t\t}\n\t\t\t},\n\t\t\tget href() {\n\t\t\t\treturn getLinkProperty(this.uuid, 'href');\n\t\t\t},\n\t\t\tset href(value) {\n\t\t\t\tsetLinkProperty(this.uuid, 'href', value);\n\t\t\t},\n\t\t\tget origin() {\n\t\t\t\tvar self = this;\n\n\t\t\t\treturn getLinkProperty(self.uuid, 'origin') || self.protocol + '//' + self.host;\n\t\t\t},\n\t\t\tget protocol() {\n\t\t\t\treturn getLinkProperty(this.uuid, 'protocol');\n\t\t\t},\n\t\t\tset protocol(value) {\n\t\t\t\tsetLinkProperty(this.uuid, 'protocol', value);\n\t\t\t},\n\t\t\tget username() {\n\t\t\t\treturn getLinkProperty(this.uuid, 'username');\n\t\t\t},\n\t\t\tset username(value) {\n\t\t\t\tsetLinkProperty(this.uuid, 'username', value);\n\t\t\t},\n\t\t\tget password() {\n\t\t\t\treturn getLinkProperty(this.uuid, 'password');\n\t\t\t},\n\t\t\tset password(value) {\n\t\t\t\tsetLinkProperty(this.uuid, 'password', value);\n\t\t\t},\n\t\t\tget host() {\n\t\t\t\tvar value, protocol;\n\n\t\t\t\tif(value = getLinkProperty(this.uuid, 'host')) {\n\t\t\t\t\tprotocol = getLinkProperty(this.uuid, 'protocol');\n\n\t\t\t\t\treturn regexMatchDefaults[protocol] ? value.replace(regexMatchDefaults[protocol], '') : value;\n\t\t\t\t}\n\t\t\t},\n\t\t\tset host(value) {\n\t\t\t\tsetLinkProperty(this.uuid, 'host', value);\n\t\t\t},\n\t\t\tget hostname() {\n\t\t\t\treturn getLinkProperty(this.uuid, 'hostname');\n\t\t\t},\n\t\t\tset hostname(value) {\n\t\t\t\tsetLinkProperty(this.uuid, 'hostname', value);\n\t\t\t},\n\t\t\tget port() {\n\t\t\t\treturn getLinkProperty(this.uuid, 'port');\n\t\t\t},\n\t\t\tset port(value) {\n\t\t\t\tsetLinkProperty(this.uuid, 'port', value);\n\t\t\t},\n\t\t\tget pathname() {\n\t\t\t\tvar value;\n\n\t\t\t\tif(value = getLinkProperty(this.uuid, 'pathname')) {\n\t\t\t\t\treturn regexMatchLeadingSlash.test(value) ? value : '/' + value;\n\t\t\t\t}\n\t\t\t},\n\t\t\tset pathname(value) {\n\t\t\t\tsetLinkProperty(this.uuid, 'pathname', value);\n\t\t\t},\n\t\t\tget search() {\n\t\t\t\treturn getLinkProperty(this.uuid, 'search');\n\t\t\t},\n\t\t\tset search(value) {\n\t\t\t\tsetLinkProperty(this.uuid, 'search', value);\n\n\t\t\t\tParameter.update.call(this);\n\t\t\t},\n\t\t\tget hash() {\n\t\t\t\treturn getLinkProperty(this.uuid, 'hash');\n\t\t\t},\n\t\t\tset hash(value) {\n\t\t\t\tsetLinkProperty(this.uuid, 'hash', value);\n\t\t\t}\n\t\t};\n\n\t\treturn Url.extends(abstractUuid);\n\t}\n\n\tprovide([ '/demand/abstract/uuid', '/demand/descriptor', '/demand/function/iterate' ], definition);\n}(this, document));\n"]}