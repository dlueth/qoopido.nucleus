{"version":3,"sources":["emitter.js"],"names":["undefined","provide","Weakmap","iterate","regexMatchExcludedMethods","objectDefineProperty","Object","defineProperty","objectGetOwnPropertyNames","getOwnPropertyNames","objectGetOwnPropertyDescriptor","getOwnPropertyDescriptor","objectGetPrototypeOf","getPrototypeOf","objectPrototype","prototype","storage","getStorage","context","get","set","wrap","self","this","constructor","object","names","i","name","keys","indexOf","push","__proto__","error","getPropertyNames","forEach","property","event","descriptor","getPropertyDescriptor","test","charAt","toUpperCase","slice","value","result","emit","arguments","apply","Emitter","call","on","events","fn","pointer","split","one","each","listener","off","j","splice","length","temp"],"mappings":"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","file":"emitter.js","sourcesContent":["/**\n * @use /demand/weakmap\n */\n\n(function(undefined) {\n\t'use strict';\n\n\tfunction definition(Weakmap, iterate) {\n\t\tvar regexMatchExcludedMethods      = /^(_|((get|has|is)([A-Z]|$))|(on|one|off|emit|constructor)$)/,\n\t\t\tobjectDefineProperty           = Object.defineProperty,\n\t\t\tobjectGetOwnPropertyNames      = Object.getOwnPropertyNames,\n\t\t\tobjectGetOwnPropertyDescriptor = Object.getOwnPropertyDescriptor,\n\t\t\tobjectGetPrototypeOf           = Object.getPrototypeOf,\n\t\t\tobjectPrototype                = Object.prototype,\n\t\t\tstorage                        = new Weakmap();\n\n\t\tfunction getStorage(context) {\n\t\t\treturn storage.get(context) || (storage.set(context, {}) && storage.get(context));\n\t\t}\n\n\t\tfunction getPropertyNames(object) {\n\t\t\tvar prototype = object,\n\t\t\t\tkeys      = [],\n\t\t\t\tnames, i, name;\n\n\t\t\ttry {\n\t\t\t\twhile(prototype !== objectPrototype) {\n\t\t\t\t\tfor(names = objectGetOwnPropertyNames(prototype), i = 0; (name = names[i]); i++) {\n\t\t\t\t\t\tkeys.indexOf(name) === -1 && keys.push(name);\n\t\t\t\t\t}\n\n\t\t\t\t\tprototype = prototype.__proto__;\n\t\t\t\t}\n\t\t\t} catch(error) {\n\t\t\t\t// required for IE compatibility\n\t\t\t}\n\n\t\t\treturn keys;\n\t\t}\n\n\t\tfunction getPropertyDescriptor(object, property) {\n\t\t\tvar prototype = object,\n\t\t\t\tdescriptor;\n\n\t\t\twhile(prototype && !(descriptor = objectGetOwnPropertyDescriptor(prototype, property))) {\n\t\t\t\tprototype = prototype.__proto__;\n\t\t\t}\n\n\t\t\treturn descriptor;\n\t\t}\n\n\t\tfunction wrap() {\n\t\t\tvar self       = this,\n\t\t\t\tprototype  = self.constructor.prototype,\n\t\t\t\tproperties = getPropertyNames(prototype);\n\n\t\t\tproperties.forEach(function(property) {\n\t\t\t\tvar descriptor = getPropertyDescriptor(prototype, property),\n\t\t\t\t\tevent;\n\n\t\t\t\tif(!descriptor.get && typeof self[property] === 'function' && regexMatchExcludedMethods.test(property) === false) {\n\t\t\t\t\tevent = property.charAt(0).toUpperCase() + property.slice(1);\n\n\t\t\t\t\tdescriptor.value = function() {\n\t\t\t\t\t\tvar result;\n\n\t\t\t\t\t\tself.emit('pre' + event, arguments);\n\n\t\t\t\t\t\tresult = prototype[property].apply(self, arguments);\n\n\t\t\t\t\t\tself.emit('post' + event, arguments, result);\n\n\t\t\t\t\t\treturn result;\n\t\t\t\t\t};\n\n\t\t\t\t\tobjectDefineProperty(self, property, descriptor);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tfunction Emitter() {\n\t\t\tif(objectGetPrototypeOf(self) !== Emitter.prototype) {\n\t\t\t\twrap.call(this);\n\t\t\t}\n\n\t\t\treturn this;\n\t\t}\n\n\t\tEmitter.prototype = {\n\t\t\ton: function(events, fn) {\n\t\t\t\tvar self    = this,\n\t\t\t\t\tpointer = getStorage(self),\n\t\t\t\t\ti = 0, event;\n\n\t\t\t\tevents = events.split(' ');\n\n\t\t\t\tfor(; (event = events[i]) !== undefined; i++) {\n\t\t\t\t\t(pointer[event] = pointer[event] || []).push(fn);\n\t\t\t\t}\n\n\t\t\t\treturn self;\n\t\t\t},\n\t\t\tone: function(events, fn, each) {\n\t\t\t\tvar self = this;\n\n\t\t\t\teach = (each !== false);\n\n\t\t\t\tself.on(events, function listener(event) {\n\t\t\t\t\tself.off(((each === true) ? event : events), listener);\n\n\t\t\t\t\tfn.apply(this, arguments);\n\t\t\t\t});\n\n\t\t\t\treturn self;\n\t\t\t},\n\t\t\toff: function(events, fn) {\n\t\t\t\tvar self    = this,\n\t\t\t\t\tpointer = getStorage(self),\n\t\t\t\t\ti = 0, event, j, listener;\n\n\t\t\t\tif(events) {\n\t\t\t\t\tevents = events.split(' ');\n\n\t\t\t\t\tfor(; (event = events[i]) !== undefined; i++) {\n\t\t\t\t\t\tpointer[event] = pointer[event] || [];\n\n\t\t\t\t\t\tif(fn) {\n\t\t\t\t\t\t\tfor(j = 0; (listener = pointer[event][j]) !== undefined; j++) {\n\t\t\t\t\t\t\t\tif(listener === fn) {\n\t\t\t\t\t\t\t\t\tpointer[event].splice(j, 1);\n\n\t\t\t\t\t\t\t\t\tj--;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tpointer[event].length = 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\titerate(self.listener, function(event) {\n\t\t\t\t\t\tpointer[event].length = 0;\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn self;\n\t\t\t},\n\t\t\temit: function(event) {\n\t\t\t\tvar self = this,\n\t\t\t\t\tpointer, temp, i = 0, listener;\n\n\t\t\t\tif(event) {\n\t\t\t\t\tpointer = getStorage(self);\n\n\t\t\t\t\tpointer[event] = pointer[event] || [];\n\t\t\t\t\ttemp           = pointer[event].slice();\n\n\t\t\t\t\tfor(; (listener = temp[i]) !== undefined; i++) {\n\t\t\t\t\t\tlistener.apply(self, arguments);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn self;\n\t\t\t}\n\t\t};\n\n\t\treturn Emitter;\n\t}\n\n\tprovide([ '/demand/weakmap', '/demand/function/iterate' ], definition);\n}());\n"]}